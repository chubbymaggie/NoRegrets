
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>NoRegrets</title>

    <!-- Bootstrap core CSS -->
    <link href="libs/bootstrap-3.3.6-dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 20px; padding-bottom: 20px; }
        .navbar { margin-bottom: 20px; }
    </style>

    <script src="libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="libs/bootstrap-3.3.6-dist/js/bootstrap.min.js"></script>
</head>

<body>

<div class="container">

    <!-- Static navbar -->
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">NoRegrets</span>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav" role="tablist">
                    <li role="presentation" class="active"><a href="#getting-started" aria-controls="getting-started" role="tab" data-toggle="tab">Getting started</a></li>
                    <li role="presentation"><a href="#NoRegrets" aria-controls="NoRegrets" role="tab" data-toggle="tab">NoRegrets</a></li>
                    <li role="presentation"><a href="#reproduce-results" aria-controls="reproduce-results" role="tab" data-toggle="tab">Reproduce results in the paper</a></li>
                    <li role="presentation"><a href="#new-input" aria-controls="new-input" role="tab" data-toggle="tab">Adding new benchmark</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
    </nav>

    <!-- Tab panes -->
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="getting-started">
            <h3>Getting started</h3>

            <p>This tutorial will guide you through the artifact evaluation of the NoRegrets tool, presented in the paper <i>"Type Regression Testing to Detect Breaking Changes in Node.js Libraries"</i> accepted at ECOOP 2018.</p>
            </p>

            <p>We recommend reading the <a href="JavaScript: $('[aria-controls=NoRegrets]').trigger('click')">NoRegrets page</a>, which gives an overview of the NoRegrets tool, before trying to <a href="JavaScript: $('[aria-controls=reproduce-results]').trigger('click')">reproduce</a> the results.

            </p>

            <p>All paths in this description are relative to the installation directory of NoRegrets, we therefore assume that the following command has been executed in the VM terminal before starting the tutorial.</p>

            <pre>$ cd ~/NoRegrets/</pre>

        </div>
        <div role="tabpanel" class="tab-pane" id="NoRegrets">
            <h1>NoRegrets</h1>
            <p>
                On this page, we give an overview of the NoRegrets tool.
                We begin with a description of how NoRegrets detects type regressions of library updates using three phases.
                We then describe each phase in detail with references to the source code of NoRegrets and pointers to the files that are generated by each phase.
            </p>
            <h2>NoRegrets approach</h2>
            <p>
                To describe the phases of the NoRegrets tool, we assume that we are interested in finding type regressions in the update of a library <i>l</i> from version <i>v</i> to <i>v'</i>.
            </p>
            <p>
                The phases are as follows and are always run in succession.
            </p>
            <ol>
                <li>
                    <strong>Finding library dependents</strong>
                    <p>
                        In this phase, NoRegrets computes set of clients <i>c</i> that both depend upon the library <i>l</i> and use the <a href="https://mochajs.org">Mocha testing framework</a>.
                        NoRegrets also removes clients whose test-suites fail with the pre-update version (<i>v</i>) of the library.
                    </p>
                </li>
                <li>
                    <strong>Generating models</strong>
                    <p>
                        In this phase, NoRegret computes the models &pi; and &pi;' by running the test suites of the clients in <i>c</i> with the ES6 proxy instrumentation.
                    </p>
                </li>
                <li>
                    <strong>Computing type regressions</strong>
                    <p>
                        In this final phase, NoRegret computes the type regressions using the models &pi; and &pi;'.
                    </p>
                </li>
            </ol>

            <h2>Phases implementation</h2>
            <h3>1. Finding library dependents</h3>
            <p>
                The class responsible for finding library dependents (clients) is <code>/server/src/main/scala-2.11/distilling/server/commands/Dependents.scala</code>.
            </p>
            <p>
                It computes the dependents using a local copy of the npm registry's metadata (see <code>out/npm-json.bin</code>)
            </p>
            <p>
                We will only use dependents that both have a <a href="https://semver.org/">SemVer</a> constraint that satisfies the pre-update version of the library, and have <a href="https://mochajs.org">Mocha</a> listed as a dependency since the NoRegrets instrumentation only works with clients that use Mocha.
            </p>
            <p>
                NoRegrets also clones the dependents and checks if the test-suites succeed with the pre-update version (<i>v</i>) of the library (see <code>server/src/main/scala-2.11/distilling/server/commands/Successfuls.scala</code>)
            </p>
            <p>
                The result of this phase is saved as <code>caching/successful-{libraryName}-{libraryVersion}-limit-all-{hash}.json</code>, where <code>limit-all</code> means that no upper-bound on the number of clients has been set.
            </p>
            <p>
                The cloned clients can be found in <a href="../out/full-cycles-new-approach/_clients">this folder</a>.
            </p>
            <h3>2. Generating models</h3>
            <p>
                The model generation is initiated by the classes found at <code>server/src/main/scala-2.11/distilling/server/commands/RegressionTypeLearner.scala</code> and <code>server/src/main/scala-2.11/distilling/server/commands/ApiTrace.scala</code>.
                The majority of the model generation code is written in TypeScript and found in the <code>api-inference/API-tracer/src</code> folder.
            </p>
            <p>
                When APITracer starts the model generation the <code>index.ts</code> file will be loaded before mocha starts executing.
                The index file loads the bootstrapper (see <code>bootstrapper.ts</code>), which overwrites the <a href="https://nodejs.org/api/modules.html#modules_require">require</a> function of NodeJS.
                The require function is overwritten such that whenever <i>l</i> is loaded, the module will be wrapped in an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">ES6 proxy</a>.
            </p>
            <p>
                The proxy handler is implemented in <code>regression-runtime-checker.ts</code>, and it emulates the instrumented interpreter whose semantics are presented in Figure 1 of the paper.
            </p>
            <p>
                When the test-suite execution finishes, the generated model will be dumped in <code>caching/learn-{libraryName}@{libraryVersion}-{clientName}@{clientVersion}.json</code>.
                The model is a JSON representation of the &pi;-model described in Section 5 of the paper.
            </p>
            <p>
                The models will be generated for both version <i>v</i> and <i>v'</i> of the library using the same set of clients.
            </p>

            <h3>3. Computing type regressions</h3>
            <p>
                The majority of the code responsible for computing the type-regressions is found in the classes <code>server/src/main/scala-2.11/distilling/server/commands/RegressionTypeLearner.scala</code> and <code>server/src/main/scala-2.11/distilling/server/regression_typechecking/TypingRelation.scala</code>.
            </p>
            <p>
                First, NoRegrets will load the models for each client, and then merge the models coming from the same version of the library (using the union type whenever two models map the same path to different types) such that it has a model &pi; of version <i>v</i> and a model &pi;' of version <i>v'</i>.
            </p>
            <p>
                Then NoRegrets iterates all paths of &pi; and &pi;', looking for type regressions using the approach described in definition 8 of the paper.
            </p>
            <p>
                All of the type regressions are saved in the file <code>caching/diff-{libraryName}-{libraryBeginVersion}-{libraryEndVersion}.json</code>.
            </p>
            <p>
                NoRegrets also includes a web interface for inspecting the type-regressions (see the <a href="JavaScript: $('[aria-controls=reproduce-results]').trigger('click')">reproduce results page</a>)
            </p>

        </div>
        <div role="tabpanel" class="tab-pane" id="reproduce-results">
            <h1>Reproducing the results in the paper</h1>
            <p>
                Reproducing the results from the paper bottom takes a long time.
                So we have precomputed the results from phase 1 and 2 (see <a href="JavaScript: $('[aria-controls=NoRegrets]').trigger('click')">NoRegrets</a>) for all the benchmarks.
            </p>
            <p>
                We will first show how to run phase 2 and 3 on lodash version 3.2.0 and 3.3.0 to reproduce only the type regressions from the motivating example.
                Then we will show how to run phase 3 on each of the 12 benchmarks from the paper.
                At last, we give an overview of the web-interface that is used to inspect the results of the experiments and show how the results from RQ1 and RQ2.1 can be derived from this interface.
            </p>
            <p>
                Phase 2 and 3 comprise the backbone of the tool, and that phase 1 is merely trivial technical requirements.
            </p>
            <p>
                The reader is, of course, welcome to run all three phases, but phase 1 is not deterministic because some clients have flaky tests.
                For this reason, recommend that our precomputed results are used when comparing with the results from the paper.
            </p>
            <p>
                The computation times have been measured on a machine with the following specifications.
            </p>
            <pre>
CPU: Intel(R) Core(TM) i7-6600U CPU @ 2.60GHz
RAM: 16GB
Disk 512GB SSD</pre>

            <h2>Computing models and type regressions for lodash version 3.2.0 and 3.3.0 (phase 2 and 3)</h2>
            <p>
                To generate the models and compute the type regressions for the lodash benchmark run the following command.
            </p>
            <pre>./noRegretsCLI regression-tc lodash 3.2.0 3.3.0 --packages-file caching/successful-lodash-3.0.0-limit-all-fffffffdd1b51cf1.json</pre>
            <p>
                <b>Notice:</b> The command takes about <b>40</b> minutes to run on the benchmark machine, and the computer may not be usable while NoRegrets is running.
            </p>
            <p>
                The <code>--packages-file</code> option specifies the list clients to use, i.e., the result of phase 1.
            </p>
            <p>
                NoRegrets will immediately start the model generation phase, which involves fetching the client, installing the correct lodash version, and then running the clients' tests with the proxy instrumentation.
                NoRegrets may use cached versions of the clients, saved under the name <code>caching/cloned-repo-{clientName}-{clientVersion}.bin</code>, if they exist.
            </p>
            <p>
                At some point you will see the message <b>Now computing type regressions</b>, indicating that the model generation phase is over (phase 2) and that NoRegrets has started the type regression checking phase (phase 3).
            </p>
            <p>
                Eventually, you will see the message <b>success</b>, indicating that the type regressions have been computed for the models.
            </p>
            <h2>Computing type regressions for the benchmarks (phase 3)</h2>
            <p>
                To compute the type regressions for all the benchmarks, run the following command
            </p>
            <pre>sbt -batch "project distilledtests-server" "test:testOnly FullRegenerateBenchmarkStatus"</pre>
            <p>
                <b>Notice:</b> The command takes about <b>120</b> minutes to run on the benchmark machine, and the computer may not be usable while NoRegrets is running.
            </p>
            <p>
                To also recompute phase 1 and 2 for all benchmarks, run the following command instead.
            </p>
            <pre>sbt -batch "project distilledtests-server" "test:testOnly FullCycleRegenerate"</pre>
            <p>
                <b>Notice:</b> Running this command may take many hours.
            </p>
            <h2>Using the type regression warnings-UI</h2>
                <p>
                    To open the warnings-ui, run the following commands.
                </p>
            <pre>
cd warnings-ui/
yarn build
yarn serve</pre>
            <p>
                This will open a browser at <code>http://localhost:3000/#/status</code> (<strong>Notice:</strong> this page may be empty if the previous steps have not been run. Use <a href="http://www.brics.dk/noregrets/NoRegretsUI/#/status">this link</a> for a hosted version of the UI with all the data).
            </p>
            <p>
                On this page every benchmark is listed along with some auxiliary information, roughly corresponding to Table 1 in the paper.
            </p>
            <ul>
                <li>
                    <b>Type Regressions</b>: The total number of type regressions detected for the benchmark.
                </li>
                <li>
                    <b>Total clients</b>: The number of clients involved in the computation of the models.
                </li>
                <li>
                    <b>Clients with type regressions</b>: The number of clients with at least one type regression in one of the library versions used in the benchmark.
                </li>
                <li>
                    <b>Accumulated model size</b>: The aggregated model size across all versions of the benchmark.
                    The model size column of Table 1 in the paper is computed by dividing this number with the total number of versions of the library used in the benchmark.
                </li>
            </ul>
            <p>
                <strong>Notice:</strong> Minor inconsistencies between the paper and the results presented on this page may be due to the non-determinism of phase 1 or flaky tests in phase 2.
                Especially the Accumulated model size may be affected.
            </p>
            <p>
                There will two versions of the lodash benchmark, one called <strong>lodash@3.2.0</strong> corresponding to phase 2 and 3 experiment conducted on lodash 3.2.0 and 3.3.0, and one called <strong>lodash@3.0.0</strong> which is the one used in the paper, and it contains all versions of lodash between 3.0.0 and 4.0.0.
            </p>
            <p>
                Clicking on one of the benchmarks will redirect to a page where the detected type regressions are listed for each version of the benchmarked library.
                If a library update is updated from version <i>v</i> to <i>v'</i>, then the type regressions listed under version <i>v'</i> are the ones introduced by the update.
            </p>
            <p>
                The <b>Path</b> column shows the Access Path of the type regression, and the <b>Type Regression</b> column shows the typing relation failure that caused the type regression.
            </p>
            <h3>Deriving results from RQ1</h3>
                <p>
                    To find NoRegret's precision as a binary classifier, count the number of minor patch updates without type regressions and the number of major updates without type regressions.
                    Then divide the sum of these two numbers with the total number of updates.
                </p>
            <h3>Deriving results from RQ2.2</h3>
            <p>
                Deriving the results of the research questions requires manual investigation of every type regression in the involved benchmarks.
            </p>
            <p>
                We refer the reader to the motivating example in Section 3 of the paper where we cover the type regressions reported in lodash@3.3.0 in detail.
            </p>

        </div>
        <div role="tabpanel" class="tab-pane" id="new-input">
            <h1>Adding new benchmark</h1>
            <p>There are two ways to add a new benchmark to NoRegrets.</p>
            <ul>
                <li>
                    <p>
                    Add a new entry to <code><a href="../server/src/test/scala-2.11/TestEntries.scala">../server/src/test/scala-2.11/TestEntries.scala</a></code>.
                    The entries have the form
                    </p>
                    <pre>
"type-is@1.0.0" should "run" in {
  perform("type-is@1.0.0")
}</pre>
                    <p>
                        Where the argument to <code>perform</code> specifies the library and first version of the library NoRegrets will run on.
                        NoRegrets will run on all versions of the library up to and including the next major version of the library.
                    </p>
                    <p>
                        Then run phase 1, 2 and 3 for the new benchmark using the following command.
                    </p>
                    <pre>
sbt -batch "project distilledtests-server" "test:testOnly FullCycleRegenerate -- -z type-is@1.0.0"</pre>
                </li>
                <li>
                    <p>
                        Use the <code>./noRegretsCLI regression-tc</code> command as used in the lodash@3.2.0 example on the <a href="JavaScript: $('[aria-controls=reproduce-results]').trigger('click')">reproduce results</a> page.
                        You have to manually create the file specifying the clients.
                    </p>
                    <p>
                        For example, using <a href="../type-is-clients.json">this file</a> containing a type-is client, you can run NoRegrets on type-is version 1.5.7 and 1.6.0 using the following command.
                    </p>
                    <pre>./noRegretsCLI regression-tc type-is 1.5.7 1.6.0 --packages-file type-is-clients.json</pre>
                </li>
            </ul>
            The results from either approach will automatically appear in the warnings-ui.
        </div>
    </div>

</div> <!-- /container -->
</body>
</html>
